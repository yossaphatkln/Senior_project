
<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="rocker_bogie_rov">

  <!-- Properties for reuse -->
  <xacro:property name="wheel_radius" value="0.07"/>
  <xacro:property name="wheel_length" value="0.04"/>
  <xacro:property name="chassis_size" value="0.334 0.254 0.115"/>
  <xacro:property name="wheel_color" value="0.3 0.3 0.3 1"/>
  <xacro:property name="blue_color" value="0 1 1 1"/>
  <xacro:property name="orange_color" value="1 0.5 0 1"/>

<!-- Base Link -->
<link name="base_link">
  <visual>
    <geometry><sphere radius="0.01"/></geometry>
    <origin xyz="0 0 0"/>
    <material name="gray"><color rgba="0.5 0.5 0.5 1"/></material>
  </visual>
</link>

<!-- Chassis Macro -->
<xacro:macro name="chassis" params="">
  <link name="chassis">
    <visual>
      <geometry><box size="${chassis_size}"/></geometry>
      <material name="green"><color rgba="0 1 0 1"/></material>
    </visual>
    <collision><geometry><box size="${chassis_size}"/></geometry></collision>
    <inertial><mass value="10"/><inertia ixx="0.05" iyy="0.05" izz="0.1"/></inertial>
  </link>
</xacro:macro>

<!-- Adjusted Cylinder Connector -->
<xacro:macro name="cylinder_connector" params="name position_y">
  <link name="${name}">
    <visual><geometry><cylinder radius="0.0075" length="0.03"/></geometry>
      <origin xyz="0 ${position_y} 0" rpy="1.5707 0 0"/>
      <material name="gray"><color rgba="0.5 0.5 0.5 1"/></material>
    </visual>
    <collision><geometry><cylinder radius="0.0075" length="0.028"/></geometry></collision>
    <inertial><mass value="0.3"/><inertia ixx="0.00003" iyy="0.00003" izz="0.00008"/></inertial>
  </link>
</xacro:macro>

<!-- Rocker Arm Macro with Balanced Inertia -->
<xacro:macro name="rocker_arm" params="name position_y">
  <link name="${name}">
    <visual><geometry><box size="0.32 0.024 0.024"/></geometry><origin xyz="-0.147 ${position_y} 0"/>
      <material name="blue"><color rgba="${blue_color}"/></material>
    </visual>
    <collision><geometry><box size="0.32 0.024 0.024"/></geometry></collision>
    <inertial><mass value="4.0"/><inertia ixx="0.01" iyy="0.012" izz="0.015"/></inertial>
  </link>
</xacro:macro>

<!-- Bogie Arm Macro -->
<xacro:macro name="bogie_arm" params="name position_y">
  <link name="${name}">
    <visual><geometry><box size="0.07 0.024 0.024"/></geometry><origin xyz="0.177 ${position_y} 0.1"/>
      <material name="orange"><color rgba="${orange_color}"/></material>
    </visual>
    <collision><geometry><box size="0.07 0.024 0.024"/></geometry></collision>
    <inertial><mass value="3.5"/><inertia ixx="0.008" iyy="0.01" izz="0.012"/></inertial>
  </link>
</xacro:macro>

<!-- Add Links -->
<xacro:chassis/>
<xacro:rocker_arm name="rocker_left" position_y="0"/>
<xacro:rocker_arm name="rocker_right" position_y="0"/>
<xacro:bogie_arm name="bogie_left" position_y="0"/>
<xacro:bogie_arm name="bogie_right" position_y="0"/>
<xacro:cylinder_connector name="cylinder_connector_left" position_y="0.145"/>
<xacro:cylinder_connector name="cylinder_connector_right" position_y="-0.145"/>

<!-- Fixed Joints -->
<xacro:fixed_joint joint_name="base_to_chassis" parent_link="base_link" child_link="chassis" origin_z="0"/>

<!-- Revolute Joints with Adjusted Limits and Damping -->
<xacro:revolute_joint joint_name="joint_cylinder_left_to_rocker_left" parent_link="cylinder_connector_left" child_link="rocker_left" origin_x="0" origin_y="0.165" origin_z="0"/>
<xacro:revolute_joint joint_name="joint_rocker_to_bogie_left" parent_link="rocker_left" child_link="bogie_left" origin_x="0.1" origin_y="0" origin_z="-0.1"/>

<!-- Wheels with Added Surface Friction -->
<xacro:macro name="wheel" params="name">
  <link name="${name}">
    <visual><geometry><cylinder radius="${wheel_radius}" length="${wheel_length}"/></geometry>
      <material name="gray"><color rgba="${wheel_color}"/></material>
    </visual>
    <collision>
      <geometry><cylinder radius="${wheel_radius}" length="${wheel_length}"/></geometry>
      <surface>
        <friction>
          <ode><mu>1.0</mu><mu2>1.0</mu2></ode>
        </friction>
      </surface>
    </collision>
    <inertial><mass value="5"/><inertia ixx="0.0005" iyy="0.0005" izz="0.001"/></inertial>
  </link>
</xacro:macro>

<!-- Wheels -->
<xacro:wheel name="wheel_front_left"/>
<xacro:wheel name="wheel_middle_left"/>
<xacro:wheel name="wheel_back_left"/>
<xacro:wheel name="wheel_front_right"/>
<xacro:wheel name="wheel_middle_right"/>
<xacro:wheel name="wheel_back_right"/>

<!-- Wheel Joints with Continuous Motion -->
<xacro:wheel_joint wheel_name="wheel_front_left" parent_link="bogie_left" origin_x="0.2" origin_y="0.03" origin_z="-0.07"/>
<xacro:wheel_joint wheel_name="wheel_middle_left" parent_link="bogie_left" origin_x="-0.12" origin_y="0.03" origin_z="-0.07"/>
<xacro:wheel_joint wheel_name="wheel_back_left" parent_link="rocker_left" origin_x="-0.3" origin_y="0.03" origin_z="-0.17"/>

<gazebo>
  <plugin name="skid_steering_plugin" filename="libgazebo_ros_skid_steer_drive.so">
    <ros><remapping>cmd_vel:=/cmd_vel</remapping></ros>
  </plugin>
</gazebo>

<!-- Adjusted Physics Settings for Improved Solver Accuracy -->
<physics type="ode">
  <max_step_size>0.001</max_step_size>
  <real_time_update_rate>1000</real_time_update_rate>
</physics>

</robot>
